import{l as e,j as a,r as s,u as t,B as i,P as l,T as n,G as r,b as o,F as c,I as d,S as h,M as u,k as x,c as j,d as g,e as v,f as m,g as p,h as y,i as f,a as S}from"./index-Dw3b-625.js";import{T as w}from"./TablePagination-tYdaDAEV.js";const P=e(a.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),b=e(a.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),N=()=>{const[e,N]=s.useState([]),[$,C]=s.useState(""),[z,I]=s.useState(""),[M,k]=s.useState(0),[A,_]=s.useState(5),B=t(),D=s.useRef(!1),F=localStorage.getItem("token"),H="http://localhost:5000";s.useEffect((()=>{if(D.current)return;D.current=!0;(async()=>{try{const e=await S.get(`${H}/invoice`);N(e.data)}catch(e){}})()}),[]);const R=JSON.parse(localStorage.getItem("user")||"null"),T=e.filter((e=>!$||e.billNo.toString().includes($.toString()))),E=T.slice(M*A,M*A+A);return a.jsx(i,{className:"box-container",children:a.jsxs(l,{elevation:3,className:"paper-container",children:[a.jsx(n,{variant:"h6",className:"typography",marginBottom:2,children:"Update Invoice"}),a.jsxs(r,{container:!0,spacing:2,children:[a.jsx(r,{size:{xs:12,md:6},children:a.jsx(o,{label:"Search",variant:"outlined",fullWidth:!0,value:$,onChange:e=>C(e.target.value)})}),a.jsx(r,{size:{xs:12,md:6},children:a.jsxs(c,{fullWidth:!0,children:[a.jsx(d,{children:"Status"}),a.jsx(h,{value:z,onChange:e=>I(e.target.value),children:["Done","Pending","Revert"].map(((e,s)=>a.jsx(u,{value:e,children:e},s)))})]})})]}),a.jsx(i,{className:"button-box",children:a.jsx(x,{variant:"contained",color:"secondary",onClick:async()=>{if($.trim())if(z)try{200===(await S.post(`${H}/invoice/invoice-update/${$}`,{status:z},{headers:{Authorization:`Bearer ${F}`}})).status&&(alert(`Invoice ${$} status updated to ${z}`),C(""),I(""),B("/invoice-list"),N((e=>e.map((e=>e.billNo===$?{...e,status:z}:e)))))}catch(e){alert("Failed to update status. Please try again.")}else alert("Please select a status.");else alert("Please enter a valid Bill No.")},children:"Submit"})}),a.jsx(j,{component:l,sx:{flex:1,overflow:"auto"},children:a.jsxs(g,{stickyHeader:!0,children:[a.jsx(v,{sx:{bgcolor:"#f5f5f5"},children:a.jsxs(m,{children:[a.jsx(p,{children:"Bill No"}),a.jsx(p,{children:"College Name"}),a.jsx(p,{children:"Date"}),a.jsx(p,{children:"Status"}),a.jsx(p,{children:"Actions"})]})}),a.jsx(y,{children:E.map((e=>a.jsxs(m,{children:[a.jsx(p,{children:e.billNo}),a.jsx(p,{children:e.college}),a.jsx(p,{children:f(new Date(e.date),"dd/MM/yyyy")}),a.jsx(p,{children:e.status}),a.jsxs(p,{children:[a.jsx(x,{onClick:()=>{(async e=>{window.confirm("Are you sure you want to edit this invoice?")&&B(`/invoice-edit/${e}`)})(e._id)},color:"secondary",disabled:"Admin"===(null==R?void 0:R.role),children:a.jsx(b,{})},e._id),a.jsx(x,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this invoice?"))try{200===(await S.post(`${H}/invoice/invoice-delete/${e}`)).status&&(alert("Invoice deleted successfully"),N((a=>a.filter((a=>a._id!==e)))))}catch(a){alert("Failed to delete invoice. Please try again.")}})(e._id),color:"secondary",disabled:"Admin"===(null==R?void 0:R.role),children:a.jsx(P,{})},e._id)]})]},e._id)))})]})}),a.jsx(w,{rowsPerPageOptions:[5,10,20,50],component:"div",count:T.length,rowsPerPage:A,page:M,onPageChange:(e,a)=>{k(a)},onRowsPerPageChange:e=>{_(parseInt(e.target.value,10)),k(0)}})]})})};export{N as default};
